
script:
  arrosage_supprimer_fichiers_voie:
    alias: Arrosage - Supprimer les fichiers pour la dernière voie existante
    description: >-
      Script qui permet de supprimer les fichiers (entrées, automatisations et scripts) pour la dernière voie existante.


      Stocke également le nombre de voie.
    sequence:
      - action: shell_command.arrosage_supprimer_fichiers_voie
        response_variable: result
      - variables:
          nouveau_nombre: "{{ result.stdout | int }}"
      - action: input_number.set_value
        data:
          entity_id: input_number.nb_file_voies
          value: "{{ nouveau_nombre }}"
      - action: logbook.log
        data:
          name: "Suppression des entités pour la dernière voie existante"
          message: "Fichier voie_{{ nouveau_nombre }}.yaml supprimé"
          entity_id: input_number.arrosage_nb_file_voies
      - action: logbook.log
        data:
          name: "Suppression du script pour la dernière voie existante"
          message: "Fichier script_arrosage_declenchement_auto_voie_{{ nouveau_nombre }}.yaml supprimé"
          entity_id: input_number.arrosage_nb_file_voies
      - action: logbook.log
        data:
          name: "Suppression de l'automatisation pour la dernière voie existante"
          message: "Fichier automatisation_arrosage_voie_{{ nouveau_nombre }}.yaml supprimé"
          entity_id: input_number.arrosage_nb_file_voies 
      - delay:
          hours: 0
          minutes: 0
          seconds: 1
          milliseconds: 0
      - action: input_number.decrement
        metadata: {}
        data: {}
        target:
          entity_id: input_number.arrosage_nb_file_voies  
    mode: single