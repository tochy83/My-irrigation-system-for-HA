# Name : automatisations.yaml
# Dans ce fichier, se trouve toutes les automatisations nécessaires au fonctionnement de l'integration sauf celles commandant les voies ou les zones d'arrosage.


automation:

  - id: 'arrosage_alerte'
    alias: Arrosage - Alerte
    description: >-
      Envoi une notification sur le téléphone ou/et télégram si l'heure prévue de fin du cycle
      d'arrosage est passée et que l'arrosage est encore marche.


      Cette automatisation est déja pré-configurée pour prendre en compte jusqu'à 9 zones d'arrosage.
      Si vous avez besoin de plus de 9 zones il faudra ajouter autant de triggers que de nouvelles zones
      (Dupliquer le dernier trigger et modifier dans le trigger dupliqué le numero de zone, partout ou il apparait dans le bloc)
      et dans la partie action autant de bloc options que de nouvelles zones
      (Dupliquer le dernier bloc option et modifier dans le bloc dupliqué le numero de zone, partout ou il apparait dans le bloc).
    triggers:
      - at: input_datetime.arrosage_duree_cycle_zone_1
        id: zone 1
        trigger: time
      - at: input_datetime.arrosage_duree_cycle_zone_2
        id: zone 2
        trigger: time
      - at: input_datetime.arrosage_duree_cycle_zone_3
        id: zone 3
        trigger: time
      - at: input_datetime.arrosage_duree_cycle_zone_4
        id: zone 4
        trigger: time
      - at: input_datetime.arrosage_duree_cycle_zone_5
        id: zone 5
        trigger: time
      - at: input_datetime.arrosage_duree_cycle_zone_6
        id: zone 6
        trigger: time
      - at: input_datetime.arrosage_duree_cycle_zone_7
        id: zone 7
        trigger: time
      - at: input_datetime.arrosage_duree_cycle_zone_8
        id: zone 8
        trigger: time
      - at: input_datetime.arrosage_duree_cycle_zone_9
        id: zone 9
        trigger: time
    conditions:
      - condition: state
        entity_id: binary_sensor.arrosage_zone_status
        state: "on"
      - condition: or
        conditions:
          - condition: state
            entity_id: input_boolean.arrosage_enable_mobileapp_notifications
            state: "on"
          - condition: state
            entity_id: input_boolean.arrosage_enable_telegram_notifications
            state: "on"
    actions:
      - choose:
          - conditions:
              - condition: trigger
                id:
                  - zone 1
              - condition: state
                entity_id: input_boolean.arrosage_auto_zone_1
                state: "on"
            sequence:
              - sequence:
                  - condition: state
                    entity_id: input_boolean.arrosage_enable_mobileapp_notifications
                    state: "on"
                  - action: script.envoi_notification_vers_mon_telephone
                    data:
                      message: >-
                        L'arrosage de la zone
                        {{state_attr('sensor.arrosage_noms_des_zones', 'zone_1') }}
                        semble être toujours en cours !
                      color: red
                      tag: arrosage
                      icon: mdi:sprinkler-variant
                      persistent: "true"
                alias: Notification application mobile
              - sequence:
                  - condition: state
                    entity_id: input_boolean.arrosage_enable_telegram_notifications
                    state: "on"
                  - action: telegram_bot.send_message
                    data:
                      title: "Arrosage - Attention"
                      message: >-
                        L'arrosage de la zone
                        {{state_attr('sensor.arrosage_noms_des_zones', 'zone_1') }}
                        semble être toujours en cours !
                alias: Notification Télégram
            alias: Zone 1
          - conditions:
              - condition: trigger
                id:
                  - zone 2
              - condition: state
                entity_id: input_boolean.arrosage_auto_zone_2
                state: "on"
            sequence:
              - sequence:
                  - condition: state
                    entity_id: input_boolean.arrosage_enable_mobileapp_notifications
                    state: "on"
                  - action: script.envoi_notification_vers_mon_telephone
                    data:
                      message: >-
                        L'arrosage de la zone
                        {{state_attr('sensor.arrosage_noms_des_zones', 'zone_2') }}
                        semble être toujours en cours !
                      color: red
                      tag: arrosage
                      icon: mdi:sprinkler-variant
                      persistent: "true"
                alias: Notification application mobile
              - sequence:
                  - condition: state
                    entity_id: input_boolean.arrosage_enable_telegram_notifications
                    state: "on"
                  - action: telegram_bot.send_message
                    data:
                      title: "Arrosage - Attention"
                      message: >-
                        L'arrosage de la zone
                        {{state_attr('sensor.arrosage_noms_des_zones', 'zone_2') }}
                        semble être toujours en cours !
                alias: Notification Télégram
            alias: Zone 2
          - conditions:
              - condition: trigger
                id:
                  - zone 3
              - condition: state
                entity_id: input_boolean.arrosage_auto_zone_3
                state: "on"
            sequence:
              - sequence:
                  - condition: state
                    entity_id: input_boolean.arrosage_enable_mobileapp_notifications
                    state: "on"
                  - action: script.envoi_notification_vers_mon_telephone
                    data:
                      message: >-
                        L'arrosage de la zone
                        {{state_attr('sensor.arrosage_noms_des_zones', 'zone_3') }}
                        semble être toujours en cours !
                      color: red
                      tag: arrosage
                      icon: mdi:sprinkler-variant
                      persistent: "true"
                alias: Notification application mobile
              - sequence:
                  - condition: state
                    entity_id: input_boolean.arrosage_enable_telegram_notifications
                    state: "on"
                  - action: telegram_bot.send_message
                    data:
                      title: "Arrosage - Attention"
                      message: >-
                        L'arrosage de la zone
                        {{state_attr('sensor.arrosage_noms_des_zones', 'zone_3') }}
                        semble être toujours en cours !
                alias: Notification Télégram
            alias: Zone 3
          - conditions:
              - condition: trigger
                id:
                  - zone 4
              - condition: state
                entity_id: input_boolean.arrosage_auto_zone_4
                state: "on"
            sequence:
              - sequence:
                  - condition: state
                    entity_id: input_boolean.arrosage_enable_mobileapp_notifications
                    state: "on"
                  - action: script.envoi_notification_vers_mon_telephone
                    data:
                      message: >-
                        L'arrosage de la zone
                        {{state_attr('sensor.arrosage_noms_des_zones', 'zone_4') }}
                        semble être toujours en cours !
                      color: red
                      tag: arrosage
                      icon: mdi:sprinkler-variant
                      persistent: "true"
                alias: Notification application mobile
              - sequence:
                  - condition: state
                    entity_id: input_boolean.arrosage_enable_telegram_notifications
                    state: "on"
                  - action: telegram_bot.send_message
                    data:
                      title: "Arrosage - Attention"
                      message: >-
                        L'arrosage de la zone
                        {{state_attr('sensor.arrosage_noms_des_zones', 'zone_4') }}
                        semble être toujours en cours !
                alias: Notification Télégram
            alias: Zone 4
          - conditions:
              - condition: trigger
                id:
                  - zone 5
              - condition: state
                entity_id: input_boolean.arrosage_auto_zone_5
                state: "on"
            sequence:
              - sequence:
                  - condition: state
                    entity_id: input_boolean.arrosage_enable_mobileapp_notifications
                    state: "on"
                  - action: script.envoi_notification_vers_mon_telephone
                    data:
                      message: >-
                        L'arrosage de la zone
                        {{state_attr('sensor.arrosage_noms_des_zones', 'zone_5') }}
                        semble être toujours en cours !
                      color: red
                      tag: arrosage
                      icon: mdi:sprinkler-variant
                      persistent: "true"
                alias: Notification application mobile
              - sequence:
                  - condition: state
                    entity_id: input_boolean.arrosage_enable_telegram_notifications
                    state: "on"
                  - action: telegram_bot.send_message
                    data:
                      title: "Arrosage - Attention"
                      message: >-
                        L'arrosage de la zone
                        {{state_attr('sensor.arrosage_noms_des_zones', 'zone_5') }}
                        semble être toujours en cours !
                alias: Notification Télégram
            alias: Zone 5
          - conditions:
              - condition: trigger
                id:
                  - zone 6
              - condition: state
                entity_id: input_boolean.arrosage_auto_zone_6
                state: "on"
            sequence:
              - sequence:
                  - condition: state
                    entity_id: input_boolean.arrosage_enable_mobileapp_notifications
                    state: "on"
                  - action: script.envoi_notification_vers_mon_telephone
                    data:
                      message: >-
                        L'arrosage de la zone
                        {{state_attr('sensor.arrosage_noms_des_zones', 'zone_6') }}
                        semble être toujours en cours !
                      color: red
                      tag: arrosage
                      icon: mdi:sprinkler-variant
                      persistent: "true"
                alias: Notification application mobile
              - sequence:
                  - condition: state
                    entity_id: input_boolean.arrosage_enable_telegram_notifications
                    state: "on"
                  - action: telegram_bot.send_message
                    data:
                      title: "Arrosage - Attention"
                      message: >-
                        L'arrosage de la zone
                        {{state_attr('sensor.arrosage_noms_des_zones', 'zone_6') }}
                        semble être toujours en cours !
                alias: Notification Télégram
            alias: Zone 6
          - conditions:
              - condition: trigger
                id:
                  - zone 7
              - condition: state
                entity_id: input_boolean.arrosage_auto_zone_7
                state: "on"
            sequence:
              - sequence:
                  - condition: state
                    entity_id: input_boolean.arrosage_enable_mobileapp_notifications
                    state: "on"
                  - action: script.envoi_notification_vers_mon_telephone
                    data:
                      message: >-
                        L'arrosage de la zone
                        {{state_attr('sensor.arrosage_noms_des_zones', 'zone_7') }}
                        semble être toujours en cours !
                      color: red
                      tag: arrosage
                      icon: mdi:sprinkler-variant
                      persistent: "true"
                alias: Notification application mobile
              - sequence:
                  - condition: state
                    entity_id: input_boolean.arrosage_enable_telegram_notifications
                    state: "on"
                  - action: telegram_bot.send_message
                    data:
                      title: "Arrosage - Attention"
                      message: >-
                        L'arrosage de la zone
                        {{state_attr('sensor.arrosage_noms_des_zones', 'zone_7') }}
                        semble être toujours en cours !
                alias: Notification Télégram
            alias: Zone 7
          - conditions:
              - condition: trigger
                id:
                  - zone 8
              - condition: state
                entity_id: input_boolean.arrosage_auto_zone_8
                state: "on"
            sequence:
              - sequence:
                  - condition: state
                    entity_id: input_boolean.arrosage_enable_mobileapp_notifications
                    state: "on"
                  - action: script.envoi_notification_vers_mon_telephone
                    data:
                      message: >-
                        L'arrosage de la zone
                        {{state_attr('sensor.arrosage_noms_des_zones', 'zone_8') }}
                        semble être toujours en cours !
                      color: red
                      tag: arrosage
                      icon: mdi:sprinkler-variant
                      persistent: "true"
                alias: Notification application mobile
              - sequence:
                  - condition: state
                    entity_id: input_boolean.arrosage_enable_telegram_notifications
                    state: "on"
                  - action: telegram_bot.send_message
                    data:
                      title: "Arrosage - Attention"
                      message: >-
                        L'arrosage de la zone
                        {{state_attr('sensor.arrosage_noms_des_zones', 'zone_8') }}
                        semble être toujours en cours !
                alias: Notification Télégram
            alias: Zone 8
          - conditions:
              - condition: trigger
                id:
                  - zone 9
              - condition: state
                entity_id: input_boolean.arrosage_auto_zone_9
                state: "on"
            sequence:
              - sequence:
                  - condition: state
                    entity_id: input_boolean.arrosage_enable_mobileapp_notifications
                    state: "on"
                  - action: script.envoi_notification_vers_mon_telephone
                    data:
                      message: >-
                        L'arrosage de la zone
                        {{state_attr('sensor.arrosage_noms_des_zones', 'zone_9') }}
                        semble être toujours en cours !
                      color: red
                      tag: arrosage
                      icon: mdi:sprinkler-variant
                      persistent: "true"
                alias: Notification application mobile
              - sequence:
                  - condition: state
                    entity_id: input_boolean.arrosage_enable_telegram_notifications
                    state: "on"
                  - action: telegram_bot.send_message
                    data:
                      title: "Arrosage - Attention"
                      message: >-
                        L'arrosage de la zone
                        {{state_attr('sensor.arrosage_noms_des_zones', 'zone_9') }}
                        semble être toujours en cours !
                alias: Notification Télégram
            alias: Zone 9
    mode: single

  - id: 'arrosage_calendrier'
    alias: Arrosage - Calendrier
    description: >-
      Détecte les événéments sur le calendrier Arrosage pour démarrer les cycles
      d'arrosage programmés


      Cette automatisation est déja pré-configurée pour prendre en compte jusqu'à 9 zones d'arrosage.
      Si vous avez besoin de plus de 9 zones il faudra ajouter dans la partie actions autant de bloc options que de nouvelles zones
      (Dupliquer le dernier bloc option et modifier dans le bloc dupliqué le numero de zone, partout ou il apparait dans le bloc).      
    triggers:
      - event: start
        offset: "0:0:0"
        entity_id: calendar.arrosage
        trigger: calendar
    conditions: []
    actions:
      - choose:
          - conditions:
              - condition: template
                value_template: >-
                  {{ state_attr('sensor.arrosage_noms_des_zones', 'zone_1') in
                  trigger.calendar_event.summary }}
              - condition: state
                entity_id: input_boolean.arrosage_programmation_zone_1
                state: "on"
            sequence:
              - metadata: {}
                data: {}
                target:
                  entity_id:
                    - input_boolean.arrosage_auto_zone_1
                action: input_boolean.turn_on
            alias: Zone 1
          - conditions:
              - condition: template
                value_template: >-
                  {{ state_attr('sensor.arrosage_noms_des_zones', 'zone_2') in
                  trigger.calendar_event.summary }}
              - condition: state
                entity_id: input_boolean.arrosage_programmation_zone_2
                state: "on"
            sequence:
              - metadata: {}
                data: {}
                target:
                  entity_id:
                    - input_boolean.arrosage_auto_zone_2
                action: input_boolean.turn_on
            alias: Zone 2
          - conditions:
              - condition: template
                value_template: >-
                  {{ state_attr('sensor.arrosage_noms_des_zones', 'zone_3') in
                  trigger.calendar_event.summary }}
              - condition: state
                entity_id: input_boolean.arrosage_programmation_zone_3
                state: "on"
            sequence:
              - metadata: {}
                data: {}
                target:
                  entity_id:
                    - input_boolean.arrosage_auto_zone_3
                action: input_boolean.turn_on
            alias: Zone 3
          - conditions:
              - condition: template
                value_template: >-
                  {{ state_attr('sensor.arrosage_noms_des_zones', 'zone_4') in
                  trigger.calendar_event.summary }}
              - condition: state
                entity_id: input_boolean.arrosage_programmation_zone_4
                state: "on"
            sequence:
              - metadata: {}
                data: {}
                target:
                  entity_id:
                    - input_boolean.arrosage_auto_zone_4
                action: input_boolean.turn_on
            alias: Zone 4
          - conditions:
              - condition: template
                value_template: >-
                  {{ state_attr('sensor.arrosage_noms_des_zones', 'zone_5') in
                  trigger.calendar_event.summary }}
              - condition: state
                entity_id: input_boolean.arrosage_programmation_zone_5
                state: "on"
            sequence:
              - metadata: {}
                data: {}
                target:
                  entity_id:
                    - input_boolean.arrosage_auto_zone_5
                action: input_boolean.turn_on
            alias: Zone 5
          - conditions:
              - condition: template
                value_template: >-
                  {{ state_attr('sensor.arrosage_noms_des_zones', 'zone_6') in
                  trigger.calendar_event.summary }}
              - condition: state
                entity_id: input_boolean.arrosage_programmation_zone_6
                state: "on"
            sequence:
              - metadata: {}
                data: {}
                target:
                  entity_id:
                    - input_boolean.arrosage_auto_zone_6
                action: input_boolean.turn_on
            alias: Zone 6
          - conditions:
              - condition: template
                value_template: >-
                  {{ state_attr('sensor.arrosage_noms_des_zones', 'zone_7') in
                  trigger.calendar_event.summary }}
              - condition: state
                entity_id: input_boolean.arrosage_programmation_zone_7
                state: "on"
            sequence:
              - metadata: {}
                data: {}
                target:
                  entity_id:
                    - input_boolean.arrosage_auto_zone_7
                action: input_boolean.turn_on
            alias: Zone 7
          - conditions:
              - condition: template
                value_template: >-
                  {{ state_attr('sensor.arrosage_noms_des_zones', 'zone_8') in
                  trigger.calendar_event.summary }}
              - condition: state
                entity_id: input_boolean.arrosage_programmation_zone_8
                state: "on"
            sequence:
              - metadata: {}
                data: {}
                target:
                  entity_id:
                    - input_boolean.arrosage_auto_zone_8
                action: input_boolean.turn_on
            alias: Zone 8
          - conditions:
              - condition: template
                value_template: >-
                  {{ state_attr('sensor.arrosage_noms_des_zones', 'zone_9') in
                  trigger.calendar_event.summary }}
              - condition: state
                entity_id: input_boolean.arrosage_programmation_zone_9
                state: "on"
            sequence:
              - metadata: {}
                data: {}
                target:
                  entity_id:
                    - input_boolean.arrosage_auto_zone_9
                action: input_boolean.turn_on
            alias: Zone 9
    mode: single

  - id: 'arrosage_nombre_electrovannes_incluses_par_zone'
    alias: Arrosage - Nombre électrovannes incluses par zone
    description: >-
      Calcule le nombre d'électrovannes qui sont cochées dans le cycle d'arrosage de
      chaque zone.


      Cette automatisation est déja pré-configurée pour prendre en compte jusqu'à 9 zones et 9 voies d'arrosage.
      Si vous avez besoin de plus de 9 voies, il faudra ajouter autant de triggers que de nouvelles voies
      (Dupliquer le dernier trigger et modifier dans le trigger dupliqué le numero de zone.
      Si vous avez besoin de plus de 9 zones, il faudra ajouter autant de nouvelles actions que de nouvelles zones
      (Dupliquer la dernière action et modifier dans l'action dupliquée le numero de zone, partout ou il apparait dans l'action).
    triggers:
      - trigger: state
        entity_id:
          - input_boolean.arrosage_enable_voie_1
          - input_boolean.arrosage_enable_voie_2
          - input_boolean.arrosage_enable_voie_3
          - input_boolean.arrosage_enable_voie_4
          - input_boolean.arrosage_enable_voie_5
          - input_boolean.arrosage_enable_voie_6
          - input_boolean.arrosage_enable_voie_7
          - input_boolean.arrosage_enable_voie_8
          - input_boolean.arrosage_enable_voie_9
    conditions: []
    actions:
      - action: input_number.set_value
        metadata: {}
        data:
          value: >-
            {%- set ns = namespace(nb_electrovanne_enabled = 0) %} {%- for item in
            label_entities("Zone 1") | select('match',
            'script.arrosage_declenchement_auto_voie') | sort %}
              {%- set ns.nb_electrovanne_enabled = ns.nb_electrovanne_enabled + 1 if is_state('input_boolean.arrosage_enable_voie_' ~ item[-1], 'on') else ns.nb_electrovanne_enabled %}
            {%- endfor %} {{ns.nb_electrovanne_enabled}}
        target:
          entity_id: input_number.arrosage_electrovannes_incluses_zone_1
        alias: Zone 1
      - action: input_number.set_value
        metadata: {}
        data:
          value: >-
            {%- set ns = namespace(nb_electrovanne_enabled = 0) %} {%- for item in
            label_entities("Zone 2") | select('match',
            'script.arrosage_declenchement_auto_voie') | sort %}
              {%- set ns.nb_electrovanne_enabled = ns.nb_electrovanne_enabled + 1 if is_state('input_boolean.arrosage_enable_voie_' ~ item[-1], 'on') else ns.nb_electrovanne_enabled %}
            {%- endfor %} {{ns.nb_electrovanne_enabled}}
        target:
          entity_id:
            - input_number.arrosage_electrovannes_incluses_zone_2
        alias: Zone 2
      - action: input_number.set_value
        metadata: {}
        data:
          value: >-
            {%- set ns = namespace(nb_electrovanne_enabled = 0) %} {%- for item in
            label_entities("Zone 3") | select('match',
            'script.arrosage_declenchement_auto_voie') | sort %}
              {%- set ns.nb_electrovanne_enabled = ns.nb_electrovanne_enabled + 1 if is_state('input_boolean.arrosage_enable_voie_' ~ item[-1], 'on') else ns.nb_electrovanne_enabled %}
            {%- endfor %} {{ns.nb_electrovanne_enabled}}
        target:
          entity_id: input_number.arrosage_electrovannes_incluses_zone_3
        alias: Zone 3
      - action: input_number.set_value
        metadata: {}
        data:
          value: >-
            {%- set ns = namespace(nb_electrovanne_enabled = 0) %} {%- for item in
            label_entities("Zone 4") | select('match',
            'script.arrosage_declenchement_auto_voie') | sort %}
              {%- set ns.nb_electrovanne_enabled = ns.nb_electrovanne_enabled + 1 if is_state('input_boolean.arrosage_enable_voie_' ~ item[-1], 'on') else ns.nb_electrovanne_enabled %}
            {%- endfor %} {{ns.nb_electrovanne_enabled}}
        target:
          entity_id: input_number.arrosage_electrovannes_incluses_zone_4
        alias: Zone 4
      - action: input_number.set_value
        metadata: {}
        data:
          value: >-
            {%- set ns = namespace(nb_electrovanne_enabled = 0) %} {%- for item in
            label_entities("Zone 5") | select('match',
            'script.arrosage_declenchement_auto_voie') | sort %}
              {%- set ns.nb_electrovanne_enabled = ns.nb_electrovanne_enabled + 1 if is_state('input_boolean.arrosage_enable_voie_' ~ item[-1], 'on') else ns.nb_electrovanne_enabled %}
            {%- endfor %} {{ns.nb_electrovanne_enabled}}
        target:
          entity_id: input_number.arrosage_electrovannes_incluses_zone_5
        alias: Zone 5
      - action: input_number.set_value
        metadata: {}
        data:
          value: >-
            {%- set ns = namespace(nb_electrovanne_enabled = 0) %} {%- for item in
            label_entities("Zone 6") | select('match',
            'script.arrosage_declenchement_auto_voie') | sort %}
              {%- set ns.nb_electrovanne_enabled = ns.nb_electrovanne_enabled + 1 if is_state('input_boolean.arrosage_enable_voie_' ~ item[-1], 'on') else ns.nb_electrovanne_enabled %}
            {%- endfor %} {{ns.nb_electrovanne_enabled}}
        target:
          entity_id: input_number.arrosage_electrovannes_incluses_zone_6
        alias: Zone 6
      - action: input_number.set_value
        metadata: {}
        data:
          value: >-
            {%- set ns = namespace(nb_electrovanne_enabled = 0) %} {%- for item in
            label_entities("Zone 7") | select('match',
            'script.arrosage_declenchement_auto_voie') | sort %}
              {%- set ns.nb_electrovanne_enabled = ns.nb_electrovanne_enabled + 1 if is_state('input_boolean.arrosage_enable_voie_' ~ item[-1], 'on') else ns.nb_electrovanne_enabled %}
            {%- endfor %} {{ns.nb_electrovanne_enabled}}
        target:
          entity_id: input_number.arrosage_electrovannes_incluses_zone_7
        alias: Zone 7
      - action: input_number.set_value
        metadata: {}
        data:
          value: >-
            {%- set ns = namespace(nb_electrovanne_enabled = 0) %} {%- for item in
            label_entities("Zone 8") | select('match',
            'script.arrosage_declenchement_auto_voie') | sort %}
              {%- set ns.nb_electrovanne_enabled = ns.nb_electrovanne_enabled + 1 if is_state('input_boolean.arrosage_enable_voie_' ~ item[-1], 'on') else ns.nb_electrovanne_enabled %}
            {%- endfor %} {{ns.nb_electrovanne_enabled}}
        target:
          entity_id: input_number.arrosage_electrovannes_incluses_zone_8
        alias: Zone 8
      - action: input_number.set_value
        metadata: {}
        data:
          value: >-
            {%- set ns = namespace(nb_electrovanne_enabled = 0) %} {%- for item in
            label_entities("Zone 9") | select('match',
            'script.arrosage_declenchement_auto_voie') | sort %}
              {%- set ns.nb_electrovanne_enabled = ns.nb_electrovanne_enabled + 1 if is_state('input_boolean.arrosage_enable_voie_' ~ item[-1], 'on') else ns.nb_electrovanne_enabled %}
            {%- endfor %} {{ns.nb_electrovanne_enabled}}
        target:
          entity_id: input_number.arrosage_electrovannes_incluses_zone_9
        alias: Zone 9
    mode: single

  - id: 'arrosage_affichage_notifications_temporaires'
    alias: Arrosage - Affichage notifications temporaires
    description: >-
      Définit la durée d'affichage des notifications temporaires ainsi que le "nom"
      de la notification concernée. Le "nom" sert dans les conditions de visibilité
      de la carte notification concernée.


      Cette automatisation est déja pré-configurée pour prendre en compte jusqu'à 9 zones d'arrosage.
      Si vous avez besoin de plus de 9 zones il faudra ajouter autant de triggers que de nouvelles zones
      (Dupliquer les 2 dernier triggers et modifier dans chaque trigger dupliqué le numero de zone, partout ou il apparait dans le bloc).
    triggers:
      - trigger: state
        entity_id:
          - input_boolean.arrosage_programmation_zone_1
        id: programmation_zone_1
      - trigger: state
        entity_id:
          - input_boolean.arrosage_auto_zone_1
        from: "off"
        to: "on"
        id: auto_zone_1
      - trigger: state
        entity_id:
          - input_boolean.arrosage_programmation_zone_2
        id: programmation_zone_2
      - trigger: state
        entity_id:
          - input_boolean.arrosage_auto_zone_2
        from: "off"
        to: "on"
        id: auto_zone_2
      - trigger: state
        entity_id:
          - input_boolean.arrosage_programmation_zone_3
        id: programmation_zone_3
      - trigger: state
        entity_id:
          - input_boolean.arrosage_auto_zone_3
        from: "off"
        to: "on"
        id: auto_zone_3
      - trigger: state
        entity_id:
          - input_boolean.arrosage_programmation_zone_4
        id: programmation_zone_4
      - trigger: state
        entity_id:
          - input_boolean.arrosage_auto_zone_4
        from: "off"
        to: "on"
        id: auto_zone_4
      - trigger: state
        entity_id:
          - input_boolean.arrosage_programmation_zone_5
        id: programmation_zone_5
      - trigger: state
        entity_id:
          - input_boolean.arrosage_auto_zone_5
        from: "off"
        to: "on"
        id: auto_zone_5
      - trigger: state
        entity_id:
          - input_boolean.arrosage_programmation_zone_6
        id: programmation_zone_6
      - trigger: state
        entity_id:
          - input_boolean.arrosage_auto_zone_6
        from: "off"
        to: "on"
        id: auto_zone_6
      - trigger: state
        entity_id:
          - input_boolean.arrosage_programmation_zone_7
        id: programmation_zone_7
      - trigger: state
        entity_id:
          - input_boolean.arrosage_auto_zone_7
        from: "off"
        to: "on"
        id: auto_zone_7
      - trigger: state
        entity_id:
          - input_boolean.arrosage_programmation_zone_8
        id: programmation_zone_8
      - trigger: state
        entity_id:
          - input_boolean.arrosage_auto_zone_8
        from: "off"
        to: "on"
        id: auto_zone_8
      - trigger: state
        entity_id:
          - input_boolean.arrosage_programmation_zone_9
        id: programmation_zone_9
      - trigger: state
        entity_id:
          - input_boolean.arrosage_auto_zone_9
        from: "off"
        to: "on"
        id: auto_zone_9
    conditions: []
    actions:
      - action: input_boolean.turn_off
        metadata: {}
        data: {}
        target:
          entity_id: input_boolean.arrosage_display_notifications
      - delay:
          hours: 0
          minutes: 0
          seconds: 0
          milliseconds: 250
        enabled: true
      - action: input_text.set_value
        metadata: {}
        data:
          value: "{{ trigger.id }}"
        target:
          entity_id: input_text.arrosage_display_notifications_choix
        alias: >-
          On stocke le trigger_id ce qui va nous permettre de choisir la
          notification à afficher
      - action: input_boolean.turn_on
        metadata: {}
        data: {}
        target:
          entity_id: input_boolean.arrosage_display_notifications
      - delay:
          hours: 0
          minutes: 0
          seconds: 3
          milliseconds: 0
        alias: >-
          Le temps de délai entré ici sert à définir la durée d'affichage des notifications
          temporaires
      - action: input_boolean.turn_off
        metadata: {}
        data: {}
        target:
          entity_id: input_boolean.arrosage_display_notifications
    mode: restart

  - id: 'arrosage_init_coeff'
    alias: Arrosage - Réinitialise le coefficient temps d'arrosage
    description: >-
      Tous les jours à minuit, remet le coefficent de temps d'arrosage à sa valeur initiale '1'


      Vous pouvez exploiter ce coeffcient en créant une automatisation qui modifierai sa valeur en fonction de la temperature de la journée par exemple.
      Bien sur pour que ça fonctionne, cette automatisation devra se lancer avant un cycle d'arrosage programmé. Libre à vous de trouver vos idées.
    mode: single
    triggers:
      - trigger: time
        at: "00:00:00"
    conditions: []
    actions:
      - action: input_number.set_value
        metadata: {}
        data:
          value: 1
        target:
          entity_id: input_number.arrosage_coefficient_temps

