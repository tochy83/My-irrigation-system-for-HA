# Name : scripts_arrosage_fichiers.yaml
# Dans ce fichier, se trouve les scripts nécessaires à la génération/suppression des fichiers entités pour les voies et les zones d'arrosage.


script:

  arrosage_generer_fichiers_voie:
    alias: Arrosage - Générer les fichiers pour une voie
    description: >-
      Script qui permet de générér les fichiers (entrées, automatisations et scripts) pour l'ajout d'une nouvelle voie, en plus de celles existantes.


      Stocke également le nombre de voie.
    sequence:
      - action: shell_command.arrosage_generer_fichiers_voie
        response_variable: result
      - variables:
          nouveau_nombre: "{{ result.stdout | int }}"
      - action: input_number.set_value
        data:
          entity_id: input_number.nb_file_voies
          value: "{{ nouveau_nombre }}"
      - action: logbook.log
        data:
          name: "Génération des entités pour une nouvelle voie"
          message: "Fichier voie_{{ nouveau_nombre }}.yaml créé"
          entity_id: input_number.arrosage_nb_file_voies
      - action: logbook.log
        data:
          name: "Génération du script pour une nouvelle voie"
          message: "Fichier script_arrosage_declenchement_auto_voie_{{ nouveau_nombre }}.yaml créé"
          entity_id: input_number.arrosage_nb_file_voies
      - action: logbook.log
        data:
          name: "Génération de l'automatisation pour une nouvelle voie"
          message: "Fichier automatisation_arrosage_voie_{{ nouveau_nombre }}.yaml créé"
          entity_id: input_number.arrosage_nb_file_voies 
      - action: input_number.increment
        metadata: {}
        data: {}
        target:
          entity_id: input_number.arrosage_nb_file_voies  
      - delay:
          hours: 0
          minutes: 0
          seconds: 0
          milliseconds: 0.5
    mode: single

  arrosage_generer_fichiers_zone:
    alias: Arrosage - Générer les fichiers pour une zone
    description: >-
      Script qui permet de générér les fichiers (entrées, automatisations et scripts) pour l'ajout d'une nouvelle zone en plus de celles existantes.


      Stocke également le numéro de la dernière zone créée.
    sequence:
      - action: shell_command.arrosage_generer_fichiers_zone
        response_variable: result
      - variables:
          nouveau_nombre: "{{ result.stdout | int }}"
      - action: input_number.set_value
        data:
          entity_id: input_number.nb_file_zones
          value: "{{ nouveau_nombre }}"
      - action: logbook.log
        data:
          name: "Génération des entités pour une nouvelle zone"
          message: "Fichier zone_{{ nouveau_nombre }}.yaml créé"
          entity_id: input_number.arrosage_nb_file_zones
      - action: logbook.log
        data:
          name: "Génération de l'automatisation pour une nouvelle zone"
          message: "Fichier automatisation_arrosage_zone_{{ nouveau_nombre }}.yaml créé"
          entity_id: input_number.arrosage_nb_file_zones
      - action: input_number.increment
        metadata: {}
        data: {}
        target:
          entity_id: input_number.arrosage_nb_file_zones 
      - delay:
          hours: 0
          minutes: 0
          seconds: 0
          milliseconds: 0.5
    mode: single

  arrosage_supprimer_fichiers_voie:
    alias: Arrosage - Supprimer les fichiers pour la dernière voie existante
    description: >-
      Script qui permet de supprimer les fichiers (entrées, automatisations et scripts) pour la dernière voie existante.


      Stocke également le nombre de voie.
    sequence:
      - action: shell_command.arrosage_supprimer_fichiers_voie
        response_variable: result
      - variables:
          nouveau_nombre: "{{ result.stdout | int }}"
      - action: input_number.set_value
        data:
          entity_id: input_number.nb_file_voies
          value: "{{ nouveau_nombre }}"
      - action: logbook.log
        data:
          name: "Suppression des entités pour la dernière voie existante"
          message: "Fichier voie_{{ nouveau_nombre }}.yaml supprimé"
          entity_id: input_number.arrosage_nb_file_voies
      - action: logbook.log
        data:
          name: "Suppression du script pour la dernière voie existante"
          message: "Fichier script_arrosage_declenchement_auto_voie_{{ nouveau_nombre }}.yaml supprimé"
          entity_id: input_number.arrosage_nb_file_voies
      - action: logbook.log
        data:
          name: "Suppression de l'automatisation pour la dernière voie existante"
          message: "Fichier automatisation_arrosage_voie_{{ nouveau_nombre }}.yaml supprimé"
          entity_id: input_number.arrosage_nb_file_voies 
      - action: input_number.decrement
        metadata: {}
        data: {}
        target:
          entity_id: input_number.arrosage_nb_file_voies
      - delay:
          hours: 0
          minutes: 0
          seconds: 0
          milliseconds: 0.5
    mode: single

  arrosage_supprimer_fichiers_zone:
    alias: Arrosage - Supprimer les fichiers pour la dernière zone existante
    description: >-
      Script qui permet de supprimer les fichiers (entrées, automatisations et scripts) pour la dernière zone existante.


      Stocke également le nombre de zone.
    sequence:
      - action: shell_command.arrosage_supprimer_fichiers_zone
        response_variable: result
      - variables:
          nouveau_nombre: "{{ result.stdout | int }}"
      - action: input_number.set_value
        data:
          entity_id: input_number.nb_file_zones
          value: "{{ nouveau_nombre }}"
      - action: logbook.log
        data:
          name: "Suppression des entités pour la dernière zone existante"
          message: "Fichier zone_{{ nouveau_nombre }}.yaml supprimé"
          entity_id: input_number.arrosage_nb_file_zones
      - action: logbook.log
        data:
          name: "Suppression de l'automatisation pour la dernière zone existante"
          message: "Fichier automatisation_arrosage_zone_{{ nouveau_nombre }}.yaml supprimé"
          entity_id: input_number.arrosage_nb_file_zones 
      - action: input_number.decrement
        metadata: {}
        data: {}
        target:
          entity_id: input_number.arrosage_nb_file_zones
      - delay:
          hours: 0
          minutes: 0
          seconds: 0
          milliseconds: 0.5
    mode: single

  arrosage_redemarrer_ha:
    alias: Arrosage - Redemarrer Home Assitant
    description: >-
      Redemarre Home Assistant avec une petite tempo pour avoir un retour visuel.
    sequence:
      - action: homeassistant.restart
        metadata: {}
        data: {}
      - delay:
          hours: 0
          minutes: 0
          seconds: 0
          milliseconds: 0.5